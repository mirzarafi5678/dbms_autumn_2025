<%- include('../../partials/head') %>
</head>
<body class="bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 min-h-screen text-white">
  <%- include('../../partials/admin-nav') %>

  <div class="container mx-auto p-6 space-y-16">
    <!-- ================= INSTITUTE MANAGEMENT ================= -->
    <section>
      <h1 class="text-3xl font-bold mb-6 text-center">Institute Management</h1>

      <!-- Search + Add -->
      <div class="flex justify-between mb-4">
        <form method="GET" action="/admin/institutes/search" class="flex gap-2">
          <input type="text" name="query" placeholder="Search by Name or License No..." 
                 class="px-3 py-2 rounded-lg text-black" />
          <button type="submit" class="bg-blue-600 px-4 py-2 rounded-lg hover:bg-blue-700">Search</button>
        </form>

        <button onclick="openAddInstituteModal()" class="bg-green-600 px-4 py-2 rounded-lg hover:bg-green-700">
          Add Institute
        </button>
      </div>

      <!-- Institute Table -->
      <div class="overflow-x-auto">
        <table class="min-w-full border border-gray-700 rounded-lg">
          <thead class="bg-blue-800 text-white">
            <tr>
              <th class="px-4 py-2 border">Institute ID</th>
              <th class="px-4 py-2 border">Name</th>
              <th class="px-4 py-2 border">License No</th>
              <th class="px-4 py-2 border">Type</th>
              <th class="px-4 py-2 border">Actions</th>
            </tr>
          </thead>
          <tbody>
            <% if (InstituteList && InstituteList.length > 0) { %>
              <% InstituteList.forEach(function(inst) { %>
                <tr class="border-b border-slate-700 hover:bg-slate-700">
                  <td class="py-2 px-4"><%= inst.id %></td>
                  <td class="py-2 px-4"><%= inst.name %></td>
                  <td class="py-2 px-4"><%= inst.licenseNo %></td>
                  <td class="py-2 px-4"><%= inst.type %></td>
                  <td class="py-2 px-4 flex gap-2">
                    <button onclick='openEditInstituteModal(<%= JSON.stringify(inst) %>)'
                            class="bg-yellow-500 px-3 py-1 rounded-lg hover:bg-yellow-600">
                      Edit
                    </button>
                    <form action="/admin/institutes/delete/<%= inst.id %>" method="POST">
                      <button type="submit" class="bg-red-600 px-3 py-1 rounded-lg hover:bg-red-700">
                        Delete
                      </button>
                    </form>
                  </td>
                </tr>
              <% }) %>
            <% } else { %>
              <tr><td colspan="5" class="text-center py-4">No institutes found</td></tr>
            <% } %>
          </tbody>
        </table>
      </div>
    </section>

    <!-- ================= AUDIT REPORT MANAGEMENT ================= -->
    <section>
      <h1 class="text-3xl font-bold mb-6 text-center">Audit Report Management</h1>

      <!-- Search + Add -->
      <div class="flex justify-between mb-4">
        <form method="GET" action="/admin/audit/search" class="flex gap-2">
          <input type="text" name="query" placeholder="Search by Institute ID..." 
                 class="px-3 py-2 rounded-lg text-black" />
          <button type="submit" class="bg-blue-600 px-4 py-2 rounded-lg hover:bg-blue-700">Search</button>
        </form>

        <button onclick="openAddAuditModal()" class="bg-green-600 px-4 py-2 rounded-lg hover:bg-green-700">
          Add Audit Report
        </button>
      </div>

      <!-- Audit Table -->
      <div class="overflow-x-auto">
        <table class="min-w-full border border-gray-700 rounded-lg">
          <thead class="bg-blue-800 text-white">
            <tr>
              <th class="px-4 py-2 border">Report ID</th>
              <th class="px-4 py-2 border">Institute ID</th>
              <th class="px-4 py-2 border">Audit Date</th>
              <th class="px-4 py-2 border">Finding Summary</th>
              <th class="px-4 py-2 border">Actions</th>
            </tr>
          </thead>
          <tbody>
            <% if (AuditList && AuditList.length > 0) { %>
              <% AuditList.forEach(function(a) { %>
                <tr class="border-b border-slate-700 hover:bg-slate-700">
                  <td class="py-2 px-4"><%= a.reportId %></td>
                  <td class="py-2 px-4"><%= a.instituteId %></td>
                  <td class="py-2 px-4"><%= a.auditDate %></td>
                  <td class="py-2 px-4"><%= a.findingSummary %></td>
                  <td class="py-2 px-4 flex gap-2">
                    <button onclick='openEditAuditModal(<%= JSON.stringify(a) %>)'
                            class="bg-yellow-500 px-3 py-1 rounded-lg hover:bg-yellow-600">
                      Edit
                    </button>
                    <form action="/admin/audit/delete/<%= a.reportId %>" method="POST">
                      <button type="submit" class="bg-red-600 px-3 py-1 rounded-lg hover:bg-red-700">
                        Delete
                      </button>
                    </form>
                  </td>
                </tr>
              <% }) %>
            <% } else { %>
              <tr><td colspan="5" class="text-center py-4">No audit reports found</td></tr>
            <% } %>
          </tbody>
        </table>
      </div>
    </section>
  </div>

  <!-- ================= INSTITUTE MODALS ================= -->
  <div id="addInstituteModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center">
    <div class="bg-slate-800 p-6 rounded-lg w-96">
      <h2 class="text-xl mb-4">Add Institute</h2>
      <form method="POST" action="/admin/institutes/add">
        <input type="text" name="name" placeholder="Name" class="w-full p-2 mb-3 rounded text-black" required>
        <input type="text" name="licenseNo" placeholder="License No" class="w-full p-2 mb-3 rounded text-black" required>
        <input type="text" name="type" placeholder="Type" class="w-full p-2 mb-3 rounded text-black" required>
        <div class="flex justify-end gap-2">
          <button type="button" onclick="closeAddInstituteModal()" class="bg-gray-600 px-3 py-1 rounded-lg hover:bg-gray-700">Cancel</button>
          <button type="submit" class="bg-green-600 px-3 py-1 rounded-lg hover:bg-green-700">Save</button>
        </div>
      </form>
    </div>
  </div>

  <div id="editInstituteModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center">
    <div class="bg-slate-800 p-6 rounded-lg w-96">
      <h2 class="text-xl mb-4">Edit Institute</h2>
      <form id="editInstituteForm" method="POST">
        <input type="text" name="name" id="editInstituteName" class="w-full p-2 mb-3 rounded text-black" required>
        <input type="text" name="licenseNo" id="editInstituteLicense" class="w-full p-2 mb-3 rounded text-black" required>
        <input type="text" name="type" id="editInstituteType" class="w-full p-2 mb-3 rounded text-black" required>
        <div class="flex justify-end gap-2">
          <button type="button" onclick="closeEditInstituteModal()" class="bg-gray-600 px-3 py-1 rounded-lg hover:bg-gray-700">Cancel</button>
          <button type="submit" class="bg-yellow-500 px-3 py-1 rounded-lg hover:bg-yellow-600">Update</button>
        </div>
      </form>
    </div>
  </div>

  <!-- ================= AUDIT REPORT MODALS ================= -->
  <div id="addAuditModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center">
    <div class="bg-slate-800 p-6 rounded-lg w-96">
      <h2 class="text-xl mb-4">Add Audit Report</h2>
      <form method="POST" action="/admin/audit/add">
        <input type="text" name="instituteId" placeholder="Institute ID" class="w-full p-2 mb-3 rounded text-black" required>
        <input type="date" name="auditDate" class="w-full p-2 mb-3 rounded text-black" required>
        <textarea name="findingSummary" placeholder="Finding Summary" class="w-full p-2 mb-3 rounded text-black" required></textarea>
        <div class="flex justify-end gap-2">
          <button type="button" onclick="closeAddAuditModal()" class="bg-gray-600 px-3 py-1 rounded-lg hover:bg-gray-700">Cancel</button>
          <button type="submit" class="bg-green-600 px-3 py-1 rounded-lg hover:bg-green-700">Save</button>
        </div>
      </form>
    </div>
  </div>

  <div id="editAuditModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center">
    <div class="bg-slate-800 p-6 rounded-lg w-96">
      <h2 class="text-xl mb-4">Edit Audit Report</h2>
      <form id="editAuditForm" method="POST">
        <input type="text" name="instituteId" id="editAuditInstituteId" class="w-full p-2 mb-3 rounded text-black" required>
        <input type="date" name="auditDate" id="editAuditDate" class="w-full p-2 mb-3 rounded text-black" required>
        <textarea name="findingSummary" id="editFindingSummary" class="w-full p-2 mb-3 rounded text-black" required></textarea>
        <div class="flex justify-end gap-2">
          <button type="button" onclick="closeEditAuditModal()" class="bg-gray-600 px-3 py-1 rounded-lg hover:bg-gray-700">Cancel</button>
          <button type="submit" class="bg-yellow-500 px-3 py-1 rounded-lg hover:bg-yellow-600">Update</button>
        </div>
      </form>
    </div>
  </div>

  <!-- ================= SCRIPTS ================= -->
  <script>
    // ===== Institute =====
    function openAddInstituteModal() { document.getElementById('addInstituteModal').classList.remove('hidden'); }
    function closeAddInstituteModal() { document.getElementById('addInstituteModal').classList.add('hidden'); }
    function openEditInstituteModal(inst) {
      document.getElementById('editInstituteName').value = inst.name;
      document.getElementById('editInstituteLicense').value = inst.licenseNo;
      document.getElementById('editInstituteType').value = inst.type;
      document.getElementById('editInstituteForm').action = `/admin/institutes/edit/${inst.id}`;
      document.getElementById('editInstituteModal').classList.remove('hidden');
    }
    function closeEditInstituteModal() { document.getElementById('editInstituteModal').classList.add('hidden'); }

    // ===== Audit =====
    function openAddAuditModal() { document.getElementById('addAuditModal').classList.remove('hidden'); }
    function closeAddAuditModal() { document.getElementById('addAuditModal').classList.add('hidden'); }
    function openEditAuditModal(a) {
      document.getElementById('editAuditInstituteId').value = a.instituteId;
      document.getElementById('editAuditDate').value = a.auditDate;
      document.getElementById('editFindingSummary').value = a.findingSummary;
      document.getElementById('editAuditForm').action = `/admin/audit/edit/${a.reportId}`;
      document.getElementById('editAuditModal').classList.remove('hidden');
    }
    function closeEditAuditModal() { document.getElementById('editAuditModal').classList.add('hidden'); }
  </script>
</body>
</html>
