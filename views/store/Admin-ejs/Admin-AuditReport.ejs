<%- include('../../partials/head') %>
</head>
<body class="bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 min-h-screen text-white">
  <%- include('../../partials/admin-nav') %>

  <div class="container mx-auto p-6 space-y-16">
    <!-- ================= INSTITUTE MANAGEMENT ================= -->
    <section>
      <h1 class="text-3xl font-bold mb-6 text-center">Institute Management</h1>

      <!-- Search + Add -->
      <div class="flex justify-between mb-4">
        <form method="GET" action="/Admin/institutes/search" class="flex gap-2">
          <input type="text" name="query" placeholder="Search by id..." 
                 class="px-3 py-2 rounded-lg text-black" />
          <button type="submit" class="bg-blue-600 px-4 py-2 rounded-lg hover:bg-blue-700">Search</button>
        </form>

         <a href="/Admin/Audit-Report-Management" 
   class="bg-green-600 px-4 py-2 rounded-lg hover:bg-green-700">
               Show ALL
         </a>

        <button onclick="openAddInstituteModal()" class="bg-green-600 px-4 py-2 rounded-lg hover:bg-green-700">
          Add Institute
        </button>
      </div>

      <!-- Institute Table -->
      <div class="overflow-x-auto">
        <table class="min-w-full border border-gray-700 rounded-lg">
          <thead class="bg-blue-800 text-white">
            <tr>
              <th class="px-4 py-2 border">id</th>
              <th class="px-4 py-2 border">name</th>
              <th class="px-4 py-2 border">licenseNumber</th>
              <th class="px-4 py-2 border">type</th>
              <th class="px-4 py-2 border">Actions</th>
            </tr>
          </thead>
          <tbody>
            <% if (InstituteList && InstituteList.length > 0) { %>
              <% InstituteList.forEach(function(inst) { %>
                <tr class="border-b border-slate-700 hover:bg-slate-700">
                  <td class="py-2 px-4"><%= inst.id %></td>
                  <td class="py-2 px-4"><%= inst.name %></td>
                  <td class="py-2 px-4"><%= inst.licenseNumber %></td>
                  <td class="py-2 px-4"><%= inst.type %></td>
                  <td class="py-2 px-4 flex gap-2">
                    <button onclick='openEditInstituteModal(<%= JSON.stringify(inst) %>)'
                            class="bg-yellow-500 px-3 py-1 rounded-lg hover:bg-yellow-600">
                      Edit
                    </button>
                    <form action="/Admin/institutes/delete/<%= inst.id %>" method="POST">
                      <button type="submit" class="bg-red-600 px-3 py-1 rounded-lg hover:bg-red-700">
                        Delete
                      </button>
                    </form>
                  </td>
                </tr>
              <% }) %>
            <% } else { %>
              <tr><td colspan="5" class="text-center py-4">No institutes found</td></tr>
            <% } %>
          </tbody>
        </table>
      </div>
    </section>

    <!-- ================= AUDIT REPORT MANAGEMENT ================= -->
    <section>
      <h1 class="text-3xl font-bold mb-6 text-center">Audit Report Management</h1>

      <!-- Search + Add -->
      <div class="flex justify-between mb-4">
        <form method="GET" action="/Admin/reports/search" class="flex gap-2">
          <input type="text" name="query" placeholder="Search by reportId..." 
                 class="px-3 py-2 rounded-lg text-black" />
          <button type="submit" class="bg-blue-600 px-4 py-2 rounded-lg hover:bg-blue-700">Search</button>
        </form>


          <a href="/Admin/Audit-Report-Management" 
   class="bg-green-600 px-4 py-2 rounded-lg hover:bg-green-700">
               Show ALL
         </a>

        <button onclick="openAddAuditModal()" class="bg-green-600 px-4 py-2 rounded-lg hover:bg-green-700">
          Add Audit Report
        </button>
      </div>

      <!-- Audit Table -->
      <div class="overflow-x-auto">
        <table class="min-w-full border border-gray-700 rounded-lg">
          <thead class="bg-blue-800 text-white">
            <tr>
              <th class="px-4 py-2 border">reportId</th>
              <th class="px-4 py-2 border">auditName</th>
              <th class="px-4 py-2 border">auditDate</th>
              <th class="px-4 py-2 border">findingsSummary</th>
              <th class="px-4 py-2 border">registrationNumber</th>
              <th class="px-4 py-2 border">Actions</th>
            </tr>
          </thead>
          <tbody>
            <% if (AuditList && AuditList.length > 0) { %>
              <% AuditList.forEach(function(a) { %>
                <tr class="border-b border-slate-700 hover:bg-slate-700">
                  <td class="py-2 px-4"><%= a.reportId %></td>
                  <td class="py-2 px-4"><%= a.auditName %></td>
                  <td class="py-2 px-4"><%= a.auditDate %></td>
                  <td class="py-2 px-4"><%= a.findingsSummary %></td>
                  <td class="py-2 px-4"><%= a.registrationNumber %></td>
                  <td class="py-2 px-4 flex gap-2">
                    <button onclick='openEditAuditModal(<%= JSON.stringify(a) %>)'
                            class="bg-yellow-500 px-3 py-1 rounded-lg hover:bg-yellow-600">
                      Edit
                    </button>
                    <form action="/Admin/reports/delete/<%= a.reportId %>" method="POST">
                      <button type="submit" class="bg-red-600 px-3 py-1 rounded-lg hover:bg-red-700">
                        Delete
                      </button>
                    </form>
                  </td>
                </tr>
              <% }) %>
            <% } else { %>
              <tr><td colspan="6" class="text-center py-4">No audit reports found</td></tr>
            <% } %>
          </tbody>
        </table>
      </div>
    </section>
  </div>

  <!-- ================= INSTITUTE MODALS ================= -->
  <div id="addInstituteModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center">
    <div class="bg-slate-800 p-6 rounded-lg w-96">
      <h2 class="text-xl mb-4">Add Institute</h2>
      <form method="POST" action="/Admin/institutes/add">
        <input type="text" name="name" placeholder="name" class="w-full p-2 mb-3 rounded text-black" required>
        <input type="text" name="licenseNumber" placeholder="licenseNumber" class="w-full p-2 mb-3 rounded text-black" required>
        <input type="text" name="type" placeholder="type" class="w-full p-2 mb-3 rounded text-black" required>
        <div class="flex justify-end gap-2">
          <button type="button" onclick="closeAddInstituteModal()" class="bg-gray-600 px-3 py-1 rounded-lg hover:bg-gray-700">Cancel</button>
          <button type="submit" class="bg-green-600 px-3 py-1 rounded-lg hover:bg-green-700">Save</button>
        </div>
      </form>
    </div>
  </div>

  <div id="editInstituteModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center">
    <div class="bg-slate-800 p-6 rounded-lg w-96">
      <h2 class="text-xl mb-4">Edit Institute</h2>
      <form id="editInstituteForm" method="POST">
        <input type="text" name="id" id="editInstituteId" class="w-full p-2 mb-3 rounded text-black" readonly required>
        <input type="text" name="name" id="editInstituteName" class="w-full p-2 mb-3 rounded text-black" required>
        <input type="text" name="licenseNumber" id="editInstituteLicense" class="w-full p-2 mb-3 rounded text-black" required>
        <input type="text" name="type" id="editInstituteType" class="w-full p-2 mb-3 rounded text-black" required>
        <div class="flex justify-end gap-2">
          <button type="button" onclick="closeEditInstituteModal()" class="bg-gray-600 px-3 py-1 rounded-lg hover:bg-gray-700">Cancel</button>
          <button type="submit" class="bg-yellow-500 px-3 py-1 rounded-lg hover:bg-yellow-600">Update</button>
        </div>
      </form>
    </div>
  </div>

  <!-- ================= AUDIT REPORT MODALS ================= -->
  <div id="addAuditModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center">
    <div class="bg-slate-800 p-6 rounded-lg w-96">
      <h2 class="text-xl mb-4">Add Audit Report</h2>
      <form method="POST" action="/Admin/reports/add">
        <input type="text" name="auditName" placeholder="auditName" class="w-full p-2 mb-3 rounded text-black" required>
        <input type="date" name="auditDate" class="w-full p-2 mb-3 rounded text-black" required>
        <textarea name="findingsSummary" placeholder="findingsSummary" class="w-full p-2 mb-3 rounded text-black" required></textarea>
        <input type="text" name="registrationNumber" placeholder="registrationNumber" class="w-full p-2 mb-3 rounded text-black">
        <div class="flex justify-end gap-2">
          <button type="button" onclick="closeAddAuditModal()" class="bg-gray-600 px-3 py-1 rounded-lg hover:bg-gray-700">Cancel</button>
          <button type="submit" class="bg-green-600 px-3 py-1 rounded-lg hover:bg-green-700">Save</button>
        </div>
      </form>
    </div>
  </div>

  <div id="editAuditModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center">
    <div class="bg-slate-800 p-6 rounded-lg w-96">
      <h2 class="text-xl mb-4">Edit Audit Report</h2>
      <form id="editAuditForm" method="POST">
        <input type="text" name="reportId" id="editReportId" class="w-full p-2 mb-3 rounded text-black" readonly required>
        <input type="text" name="auditName" id="editAuditName" class="w-full p-2 mb-3 rounded text-black" required>
        <input type="date" name="auditDate" id="editAuditDate" class="w-full p-2 mb-3 rounded text-black" required>
        <textarea name="findingsSummary" id="editFindingSummary" class="w-full p-2 mb-3 rounded text-black" required></textarea>
        <input type="text" name="registrationNumber" id="editRegistrationNumber" class="w-full p-2 mb-3 rounded text-black">
        <div class="flex justify-end gap-2">
          <button type="button" onclick="closeEditAuditModal()" class="bg-gray-600 px-3 py-1 rounded-lg hover:bg-gray-700">Cancel</button>
          <button type="submit" class="bg-yellow-500 px-3 py-1 rounded-lg hover:bg-yellow-600">Update</button>
        </div>
      </form>
    </div>
  </div>

  <!-- ================= SCRIPTS ================= -->
  <script>
    // ===== Institute =====
    function openAddInstituteModal() { document.getElementById('addInstituteModal').classList.remove('hidden'); }
    function closeAddInstituteModal() { document.getElementById('addInstituteModal').classList.add('hidden'); }
    function openEditInstituteModal(inst) {
      document.getElementById('editInstituteId').value = inst.id || '';
      document.getElementById('editInstituteName').value = inst.name || '';
      document.getElementById('editInstituteLicense').value = inst.licenseNumber || '';
      document.getElementById('editInstituteType').value = inst.type || '';
      document.getElementById('editInstituteForm').action = `/Admin/institutes/edit/${inst.id}`;
      document.getElementById('editInstituteModal').classList.remove('hidden');
    }
    function closeEditInstituteModal() { document.getElementById('editInstituteModal').classList.add('hidden'); }

    // ===== Audit =====
    function openAddAuditModal() { document.getElementById('addAuditModal').classList.remove('hidden'); }
    function closeAddAuditModal() { document.getElementById('addAuditModal').classList.add('hidden'); }
    function openEditAuditModal(a) {
      document.getElementById('editReportId').value = a.reportId || '';
      document.getElementById('editAuditName').value = a.auditName || '';
      document.getElementById('editAuditDate').value = a.auditDate || '';
      document.getElementById('editFindingSummary').value = a.findingsSummary || '';
      document.getElementById('editRegistrationNumber').value = a.registrationNumber || '';
      document.getElementById('editAuditForm').action = `/Admin/reports/edit/${a.reportId}`;
      document.getElementById('editAuditModal').classList.remove('hidden');
    }
    function closeEditAuditModal() { document.getElementById('editAuditModal').classList.add('hidden'); }
  </script>
</body>
</html>
