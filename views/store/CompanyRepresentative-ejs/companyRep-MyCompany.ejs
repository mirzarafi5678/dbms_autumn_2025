<%- include('../../partials/head') %>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 min-h-screen text-white">

<%- include('../../partials/companyRep-nav') %>

<main class="p-10">

<!-- COMPANY FORM -->
<div class="bg-gray-800 p-6 rounded-xl shadow-lg mb-12 max-w-2xl">
    <h2 class="text-xl font-semibold mb-4">Company Information</h2>

    <form action="/CompanyRep/save-company" method="POST" class="space-y-4">

        <input type="text" name="name"
               placeholder="<%= company.name || 'Company Name' %>"
               value="<%= company.name || '' %>"
               class="w-full p-3 rounded bg-gray-700 text-white">

        <input type="text" name="sector"
               placeholder="<%= company.sector || 'Sector' %>"
               value="<%= company.sector || '' %>"
               class="w-full p-3 rounded bg-gray-700 text-white">

        <input type="text" name="registrationNumber"
               placeholder="<%= company.registrationNumber || 'Registration Number' %>"
               value="<%= company.registrationNumber || '' %>"
               class="w-full p-3 rounded bg-gray-700 text-white">

        <input type="text" name="contactInfo"
               placeholder="<%= company.contactInfo || 'Contact Info' %>"
               value="<%= company.contactInfo || '' %>"
               class="w-full p-3 rounded bg-gray-700 text-white">

        <div class="flex space-x-3">
            <button type="submit"
                    class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded">
                Submit
            </button>

            <button formaction="/CompanyRep/update-company" type="submit"
                    class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded">
                Update
            </button>
        </div>
    </form>
</div>


    <!-- STOCK FORM -->
    <div class="bg-gray-800 p-6 rounded-xl shadow-lg mb-8 max-w-xl">
        <h2 class="text-xl font-semibold mb-4">Add Stock</h2>

        <form action="/CompanyRep/add-stock" method="POST" class="space-y-4">
            <input type="number" name="totalShares"
                   placeholder="Total Shares"
                   class="w-full p-3 rounded bg-gray-700 text-white">

            <input type="number" name="currentPrice"
                   placeholder="Current Price"
                   class="w-full p-3 rounded bg-gray-700 text-white">

            <button type="submit"
                    class="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded">
                Add Stock
            </button>
        </form>
    </div>


    <!-- STOCK TABLE -->
    <div class="bg-gray-800 p-6 rounded-xl shadow-lg">
        <h2 class="text-xl font-semibold mb-4">Stock List</h2>

        <table class="w-full text-left">
            <thead>
                <tr class="bg-gray-700">
                    <th class="p-3">Stock ID</th>
                    <th class="p-3">Total Shares</th>
                    <th class="p-3">Current Price</th>
                    <th class="p-3">Actions</th>
                </tr>
            </thead>

            <tbody>
                <% stocks.forEach(stock => { %>
                    <tr class="border-b border-gray-600">
                        <td class="p-3"><%= stock.stockId %></td>
                        <td class="p-3"><%= stock.totalShares %></td>
                        <td class="p-3"><%= stock.currentPrice %></td>
                        <td class="p-3 flex space-x-3">

                            <!-- EDIT BUTTON -->
                            <button 
                                onclick="openEditPopup('<%= stock.stockId %>', '<%= stock.totalShares %>', '<%= stock.currentPrice %>')"
                                class="px-3 py-1 bg-yellow-500 hover:bg-yellow-600 rounded">
                                Edit
                            </button>

                            <!-- DELETE BUTTON -->
                            <form action="/CompanyRep/delete-stock" method="POST">
                                <input type="hidden" name="stockId" value="<%= stock.stockId %>">
                                <button type="submit" 
                                        class="px-3 py-1 bg-red-600 hover:bg-red-700 rounded">
                                    Delete
                                </button>
                            </form>

                        </td>
                    </tr>
                <% }) %>
            </tbody>
        </table>
    </div>


    <!-- EDIT POPUP MODAL -->
    <div id="editModal"
         class="fixed inset-0 hidden bg-black bg-opacity-70 flex items-center justify-center">

        <div class="bg-gray-800 p-8 rounded-xl w-96">
            <h2 class="text-xl font-semibold mb-4">Edit Stock</h2>

            <form action="/CompanyRep/update-stock" method="POST" class="space-y-3">
                
                <input id="editStockId" name="stockId"
                       readonly
                       class="w-full p-3 rounded bg-gray-700 text-gray-400">

                <input id="editTotalShares" name="totalShares"
                       class="w-full p-3 rounded bg-gray-700 text-white">

                <input id="editCurrentPrice" name="currentPrice"
                       class="w-full p-3 rounded bg-gray-700 text-white">

                <button type="submit"
                        class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded w-full">
                    Save Changes
                </button>

                <button type="button" onclick="closeEditPopup()"
                        class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded w-full mt-2">
                    Cancel
                </button>
            </form>
        </div>

    </div>


</main>

<script>
function openEditPopup(id, shares, price) {
    document.getElementById("editStockId").value = id;
    document.getElementById("editTotalShares").placeholder = shares;
    document.getElementById("editCurrentPrice").placeholder = price;

    document.getElementById("editModal").classList.remove("hidden");
}

function closeEditPopup() {
    document.getElementById("editModal").classList.add("hidden");
}
</script>

</body>
</html>
