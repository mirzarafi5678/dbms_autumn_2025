<%- include('../../partials/head') %>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 min-h-screen text-white">
  <%- include('../../partials/Investor-nav') %>
<main class="Flexible">
  <div class="p-10 mt-10 space-y-12">

    <!-- ====================== COMPANY TABLE ======================= -->
    <div class="bg-slate-800 p-8 rounded-2xl shadow-lg w-full">
      <h2 class="text-2xl font-bold mb-6 text-center">Company Details</h2>

      <table class="w-full text-left border-collapse">
        <thead>
              <tr class="bg-slate-700 text-sm">
                <th class="p-3">Registration Number</th>
                <th class="p-3">Name</th>
                <th class="p-3">Sector</th>
                <th class="p-3">Contact Info</th>
              </tr>
        </thead>

        <tbody>
          <% CompanyList.forEach(company => { %>
            <tr class="border-b border-slate-700 hover:bg-slate-700/40 transition">
              <td class="p-3"><%= company.registrationNumber %></td>
              <td class="p-3"><%= company.name %></td>
              <td class="p-3"><%= company.sector %></td>
              <td class="p-3"><%= company.contactInfo %></td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>


    <!-- ====================== STOCK TABLE ======================= -->
    <div class="bg-slate-800 p-8 rounded-2xl shadow-lg w-full">
      <h2 class="text-2xl font-bold mb-6 text-center">Stock List</h2>

      <table class="w-full text-left border-collapse">
        <thead>
          <tr class="bg-slate-700 text-sm">
            <th class="p-3">Registration Number</th>
            <th class="p-3">Stock ID</th>
            <th class="p-3">Total Shares</th>
            <th class="p-3">Current Price</th>
            <th class="p-3">Action</th>
          </tr>
        </thead>

        <tbody>
          <% StockList.forEach(stock => { %>
            <tr class="border-b border-slate-700 hover:bg-slate-700/40 transition">
              <td class="p-3"><%= stock.registrationNumber %></td>
              <td class="p-3"><%= stock.stockId %></td>
              <td class="p-3"><%= stock.totalShares %></td>
              <td class="p-3">$<%= stock.currentPrice %></td>

              <td class="p-3">
                <button class="bg-blue-600 hover:bg-blue-700 px-4 py-1 rounded text-sm buyBtn"
                        data-id="<%= stock.stockId %>">
                  Buy
                </button>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>

      <!-- Success message -->
      <p id="buyMessage" class="text-green-400 text-center mt-4 hidden font-medium">
                 Done
      </p>
    </div>

  </div>
</main>
  <script>
    // BUY BUTTON HANDLER
    document.querySelectorAll(".buyBtn").forEach(btn => {
      btn.addEventListener("click", async () => {
        const stockId = btn.getAttribute("data-id");

        const response = await fetch("/Investor/buy-stock", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ stockId })
        });

        const msg = document.getElementById("buyMessage");
        msg.classList.remove("hidden");
        setTimeout(() => msg.classList.add("hidden"), 2000);
      });
    });
  </script>

</body>
</html>
