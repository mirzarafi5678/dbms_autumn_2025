<%- include('../../partials/head') %>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 min-h-screen text-white">
  <%- include('../../partials/Investor-nav') %>

  <div class="container mx-auto py-10 px-4">
    <!-- Form Section -->
    <div class="bg-slate-800 p-6 rounded-2xl shadow-lg max-w-xl mx-auto mb-10">
      <h2 class="text-2xl font-bold mb-4 text-center">Add Transaction</h2>
      <form id="transactionForm" class="space-y-4">
        <div>
          <label for="tid" class="block mb-1 font-semibold">Transaction ID</label>
          <input type="text" id="tid" name="tid" class="w-full p-2 rounded bg-slate-700 border border-slate-600" required>
        </div>
        <div>
          <label for="stockId" class="block mb-1 font-semibold">Stock ID</label>
          <input type="text" id="stockId" name="stockId" class="w-full p-2 rounded bg-slate-700 border border-slate-600" required>
        </div>
        <div>
          <label for="investorId" class="block mb-1 font-semibold">Investor ID</label>
          <input type="text" id="investorId" name="investorId" class="w-full p-2 rounded bg-slate-700 border border-slate-600" required>
        </div>
        <div>
          <label for="amount" class="block mb-1 font-semibold">Amount</label>
          <input type="number" id="amount" name="amount" class="w-full p-2 rounded bg-slate-700 border border-slate-600" required>
        </div>
        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 py-2 rounded font-semibold transition">Add</button>
      </form>
      <p id="successMsg" class="text-green-400 text-center mt-4 hidden">âœ… Transaction Added!</p>
    </div>

    <!-- Table Section -->
    <div class="bg-slate-800 p-6 rounded-2xl shadow-lg max-w-4xl mx-auto">
      <h2 class="text-2xl font-bold mb-4 text-center">Transaction List</h2>
      <table class="w-full table-auto border-collapse border border-slate-600">
        <thead>
          <tr class="bg-slate-700">
            <th class="border border-slate-600 px-4 py-2">TID</th>
            <th class="border border-slate-600 px-4 py-2">Stock ID</th>
            <th class="border border-slate-600 px-4 py-2">Investor ID</th>
            <th class="border border-slate-600 px-4 py-2">Amount</th>
          </tr>
        </thead>
        <tbody id="transactionTableBody">
          <% if (transactionList && transactionList.length > 0) { %>
            <% transactionList.forEach(tx => { %>
              <tr>
                <td class="border border-slate-600 px-4 py-2"><%= tx.tid %></td>
                <td class="border border-slate-600 px-4 py-2"><%= tx.stockId %></td>
                <td class="border border-slate-600 px-4 py-2"><%= tx.investorId %></td>
                <td class="border border-slate-600 px-4 py-2"><%= tx.amount %></td>
              </tr>
            <% }) %>
          <% } %>
        </tbody>
      </table>
    </div>
  </div>

  <script>
    const form = document.getElementById('transactionForm');
    const tableBody = document.getElementById('transactionTableBody');
    const successMsg = document.getElementById('successMsg');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const tid = document.getElementById('tid').value;
      const stockId = document.getElementById('stockId').value;
      const investorId = document.getElementById('investorId').value;
      const amount = document.getElementById('amount').value;

      try {
        const res = await fetch('/investor/add-transaction', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ tid, stockId, investorId, amount })
        });

        if (res.ok) {
          const newTx = await res.json();

          // Add new row to table
          const row = document.createElement('tr');
          row.innerHTML = `
            <td class="border border-slate-600 px-4 py-2">${newTx.tid}</td>
            <td class="border border-slate-600 px-4 py-2">${newTx.stockId}</td>
            <td class="border border-slate-600 px-4 py-2">${newTx.investorId}</td>
            <td class="border border-slate-600 px-4 py-2">${newTx.amount}</td>
          `;
          tableBody.appendChild(row);

          // Show success message
          successMsg.classList.remove('hidden');
          setTimeout(() => successMsg.classList.add('hidden'), 2000);

          // Clear form
          form.reset();
        }
      } catch (err) {
        console.error('Error adding transaction:', err);
      }
    });
  </script>
</body>
</html>
